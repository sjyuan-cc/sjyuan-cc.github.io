---
layout: post

title: "如何界定代码腐化？"
date: 2020-06-11
categories: [eXtreme Programming]
tags: [REFACTORING-QUESTION-100]
column: REFACTORING-QUESTION-100
sub-tag: "Code Design"

author: "袁慎建"

brief: "
百问重构系列问答。
"

---

* content
{:toc}

---

这个问题Scope很大，关于代码腐化的定义，仁者见仁、智者见智。在我看来，最好不要去做代码腐化的鉴定，在编写代码的过程中，时刻关注代码质量，在点点滴滴将代码质量把关控制好，如果真的到了要评审和鉴定代码腐化程度的时候，说明代码库已经不健康了，而且还没有及时去做挽救。

相比于鉴定，我更建议通过一些措施来预防代码变坏，比如可以通过一些敏捷工程实践，Pair，Code Review、TDD、Simple Design。就我在交付项目上的经验来看，代码库健康状况很好的时候都是团队Code Review实践做的神形合一的时候。Code Review是一项有效阻止代码库腐化的手段。为了说明不是我在胡说八道，简单分享一下我过去的两个经历。

2017年，我在一个国内大客户项目上做交付，进去之后发现大家对Code Review的重视程度并不高，平时疲于交付和各种会议，Code Review处于两天打渔三天晒网的状态。更糟糕的是，Code Review没有什么人能够提出针对代码设计上的有效反馈，导致Code Review不痛不痒，其实没什么帮助。我开始重视了这件事情，发现当我去推动的时候，其实推动这个实践本身没收到什么阻力，然后我就在Code Review的过程中经常“怼人”，经常“挑刺”，这个过程，逐渐将这个氛围带动起来。从那以后，代码库不会出现一些明显的坏味道，并且重复的问题也不常见了。而且，Code Review的发声者也越来越多了。

2019年，我在给公司内部新加坡的一个项目做了两周的内部咨询，正好这个时候这个项目的TL和一个Second Tier在参加我的敏捷工程实践训练营。我前后花了几天时间，针对他们现在做的敏捷实践做了一个调研（约时间约了好几次，因为项目上会议太多了），也实地跟了几次团队Code Review和站会。发现Code Review出了点问题，Code Review有点像在走过场，而且经常会因为临时的会议取消掉。并且Review的方式也不对，在Review的时候花多时间介绍业务，由于TimeBox，留给Review代码设计时间很少，每次匆匆了事。另外做完了Review，也缺乏Action跟踪，没有形成闭环，虽然好像也在做Code Review，但效果很不好。接下来，我就重点针对Code Review给了一些建议，他们在团队中也大力推行，2个月后我这边收到了他们反馈，因为坚持做好Code Review，代码状况明显好转了。当然，参加了训练营的两位，也将TDD在项目中推行下来，从其他方面也有改善。

两个经历让我对Code Review的价值更加确定，如果说在ThoughtWorks，人人都可以充当敏捷教练，我觉得如果某个团队的Code Review做不好，这个团队可能没有合格的敏捷教练。

Code Review要做到神形合一，很多时候需要额外的推动了，并且需要有一些有代码美感的人混迹其中，制造“冲突”。
